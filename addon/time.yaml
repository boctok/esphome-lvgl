# time.yaml

time:
  - platform: sntp
    id: sntp_time
    timezone: "Europe/Berlin"
    servers:
     - 0.pool.ntp.org
     - 1.pool.ntp.org
     - 2.pool.ntp.org
    # Der on_time_sync Trigger ist optional, kann aber nützlich sein,
    # um einmalig Aktionen nach erfolgreicher Zeitsynchronisation auszuführen.
    # Für die reine Anzeige wird er nicht zwingend benötigt.
    # on_time_sync:
    #   - # Hier könnten Aktionen stehen, z.B. ein Logeintrag oder das Setzen eines globalen Flags

    on_time:
      # Aktualisiere die Uhrzeit auf dem Display jede Minute, zur Sekunde 0
      - minutes: '*'
        seconds: 0
        then:
          - lvgl.label.update:
              id: display_time # Stellt sicher, dass diese ID mit deinem Label in lvgl.yaml übereinstimmt [1]
              text: !lambda |-
                static char time_buf[6]; // Puffer für "HH:MM" und Nullterminator
                auto now = id(sntp_time).now();
                if (now.is_valid()) { // Prüfe, ob eine gültige Zeit vom SNTP-Server vorliegt
                  snprintf(time_buf, sizeof(time_buf), "%02d:%02d", now.hour, now.minute);
                  return std::string(time_buf);
                }
                return std::string("--:--"); // Fallback, falls keine gültige Zeit verfügbar ist
