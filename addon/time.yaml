# time.yaml

time:
  - platform: sntp
    id: sntp_time
    timezone: "Europe/Berlin"
    servers:
     - 0.pool.ntp.org
     - 1.pool.ntp.org
     - 2.pool.ntp.org
    on_time_sync: # SEHR WICHTIG für die Diagnose! Wird einmalig ausgelöst, wenn die Zeit synchronisiert wurde.
      - logger.log: "SNTP: Zeit erfolgreich initial synchronisiert!"
    on_time:
      - minutes: '*'
        seconds: 0
        then:
          - logger.log: "DEBUG (time.yaml): 'on_time' Trigger für Uhrzeit-Label-Update ausgelöst."
          - lvgl.label.update:
              id: display_time
              text: !lambda |-
                // ESP_LOGD("time_lambda", "Lambda für display_time wird ausgeführt."); // Für noch detaillierteres Logging ggf. einkommentieren
                static char time_buf[6];
                auto now = id(sntp_time).now();
                if (now.is_valid()) {
                  // ESP_LOGD("time_lambda", "SNTP Zeit ist gültig: %02d:%02d", now.hour, now.minute); // Für Debugging einkommentieren
                  snprintf(time_buf, sizeof(time_buf), "%02d:%02d", now.hour, now.minute);
                  return std::string(time_buf);
                } else {
                  // ESP_LOGW("time_lambda", "SNTP Zeit ist NICHT gültig. Fallback '--:--' wird verwendet."); // Für Debugging einkommentieren
                  return std::string("--:--");
                }

